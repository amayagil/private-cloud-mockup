# playbooks/00_setup_vars.yml
---
- name: Vars settings
  hosts: localhost
  connection: local
  gather_facts: no

  pre_tasks:
    - name: Load VM Config
      ansible.builtin.include_vars:
        file: "{{ playbook_dir }}/../vars/vm_config.yml"
        name: vm_config

    - name: Load Capacity Profiles
      ansible.builtin.include_vars:
        file: "{{ playbook_dir }}/../vars/capacity_profiles.yml"
        name: capacity_data

  tasks:
    - name: Set vm_profile based on selection
      ansible.builtin.set_fact:
        capacity_data: "{{ capacity_data | default({'capacity_profiles': {'small': {'cpu': 2, 'ram_gb': 4, 'storage_gb': 50}, 'medium': {'cpu': 4, 'ram_gb': 8, 'storage_gb': 100}, 'large': {'cpu': 8, 'ram_gb': 16, 'storage_gb': 200}}}) }}"
        vm_config: "{{ vm_config | default({'selected_capacity_profile': 'medium', 'vm_name': 'default-vm'}) }}"

    - name: Confirm Profile Loaded
      ansible.builtin.debug:
        msg: "Capacity Profile '{{ selected_capacity_profile | upper }}' loaded: CPU={{ vm_profile.cpu_cores }}, RAM={{ vm_profile.memory_gb }} GB, Disk={{ vm_profile.disk_size_gb }} GB."